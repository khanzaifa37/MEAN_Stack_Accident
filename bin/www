var bodyParser      =require("body-parser"),
    mongoose        =require("mongoose"),
    express         =require("express"),
    methodOverride = require('method-override'),
    request         =require("request"),
    cors            =require("cors"),
    path            =require("path"),
    route           =require("./routes/route.js"),
    bluebird        =require('bluebird'),
    app             =express(),
    cfenv           =require("cfenv");

var appEnv = cfenv.getAppEnv()
var mongoLabUrl = appEnv.getServiceURL('mongo');
mongoose.connect(mongoLabUrl);
mongoose.connection.on("error",(err)=>{
    if(err)
    console.log("Error from here in connecting to mongo @27017");
});
const corsOptions = {
        origin: 'http://localhost:4200',
        optionsSuccessStatus: 200
}
app.use(cors(corsOptions))
app.use(bodyParser.json());
//APP Config
app.set("view engine", "ejs");

app.use(express.static("public"));
app.use(methodOverride('_method'));
app.use('/api',route);


var port = normalizePort(process.env.PORT || process.env.VCAP_APP_PORT || '3000');

app.listen(port, function(){
    console.log("Listening at http://localhost:3000");
} );
